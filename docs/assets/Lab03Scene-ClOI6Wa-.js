import{r as p,j as e,aa as j,a4 as v,a9 as w,a1 as A,a5 as E,x,k as S,aj as k,ak as R,J as I,al as b}from"./three-Cwdqg_u8.js";import{u as P,b as C}from"./index-sb9UF3ya.js";import"./vendor-CqO7gtIP.js";import"./animation-B64uUSMy.js";const T=m=>{const[u,i]=p.useState(null),c=p.useRef(null),l=p.useRef(null);return p.useEffect(()=>{let a=!0;const n=()=>{l.current&&l.current.getTracks().forEach(t=>t.stop()),c.current&&c.current.close()};return m==="mic"?(n(),(async()=>{try{const s=await navigator.mediaDevices.getUserMedia({audio:!0});l.current=s;const r=new(window.AudioContext||window.webkitAudioContext);c.current=r;const o=r.createMediaStreamSource(s),d=r.createAnalyser();d.fftSize=256,o.connect(d),a&&i(d)}catch(s){console.error("Mic Error:",s)}})()):(n(),setTimeout(()=>{a&&i(null)},0)),()=>{a=!1,n()}},[m]),u},_=({analyser:m,mode:u})=>{const i=p.useRef(),c=500,[l]=p.useState(()=>{const n=new Float32Array(c*3);for(let t=0;t<c;t++)n[t*3]=(Math.random()-.5)*10,n[t*3+1]=(Math.random()-.5)*5,n[t*3+2]=(Math.random()-.5)*5;return n}),a=p.useMemo(()=>new Uint8Array(128),[]);return x(n=>{if(!i.current)return;let t=0;if(u==="mic"&&m)m.getByteFrequencyData(a),t=a.reduce((o,d)=>o+d,0)/a.length/255;else{const o=n.clock.elapsedTime;t=(Math.sin(o)*.5+.5)*.5}const s=i.current.geometry.attributes.position.array;for(let o=0;o<c;o++){let d=l[o*3],f=l[o*3+1],h=l[o*3+2];const y=1+t*2,g=n.clock.elapsedTime,M=Math.sin(g+d)*.2;s[o*3]=d*y+Math.sin(g*2+f)*.1,s[o*3+1]=f*y+Math.cos(g*1.5+d)*.1,s[o*3+2]=h*y+M}i.current.geometry.attributes.position.needsUpdate=!0;const r=i.current.material;r&&(r.size=.05+t*.2,r.color&&r.color.setHSL(.5+t*.5,1,.5))}),e.jsx(k,{ref:i,positions:l,stride:3,children:e.jsx(R,{transparent:!0,color:"#facc15",size:.05,sizeAttenuation:!0,depthWrite:!1,blending:I})})},U=({analyser:m,mode:u})=>{const i=p.useRef(),c=16,l=.6,a=p.useMemo(()=>new Uint8Array(32),[]);return x(n=>{if(!i.current)return;let t=[];if(u==="mic"&&m)m.getByteFrequencyData(a),t=Array.from(a).slice(0,c);else{const s=n.clock.elapsedTime;for(let r=0;r<c;r++){const o=(Math.sin(s*3+r*.5)+Math.cos(s*2+r*.2))*.5+.5;t.push(o*255)}}i.current.children.forEach((s,r)=>{if(t[r]!==void 0&&s.material){const o=t[r]/255,d=.5+o*5;s.scale.y=b.lerp(s.scale.y,d,.2);const f=.5+o*.3;s.material.color&&s.material.color.setHSL(f,1,.5),s.material.emissive&&s.material.emissive.setHSL(f,1,.2),"emissiveIntensity"in s.material&&(s.material.emissiveIntensity=o*3)}})}),e.jsx("group",{ref:i,position:[-9.6/2,-2,0],children:Array.from({length:c}).map((n,t)=>e.jsxs("mesh",{position:[t*l,2,0],children:[e.jsx("boxGeometry",{args:[.4,1,.4]}),e.jsx("meshStandardMaterial",{color:"#06b6d4",roughness:.2,metalness:.8})]},t))})},F=({analyser:m,mode:u})=>{const i=p.useRef(),c=p.useMemo(()=>new Uint8Array(64),[]);return x(l=>{if(!i.current)return;let a=0;u==="mic"&&m?(m.getByteFrequencyData(c),a=c.reduce((r,o)=>r+o,0)/c.length/255):a=(Math.sin(l.clock.elapsedTime)*.5+.5)*.6;const n=i.current.geometry.attributes.position,t=l.clock.elapsedTime;for(let r=0;r<n.count;r++){const o=n.getX(r),d=n.getY(r),f=Math.sqrt(o*o+d*d);let h=Math.sin(f*1.5-t*2)*(.2+a*1.5);h+=Math.cos(o*2+t)*.1,n.setZ(r,h)}n.needsUpdate=!0;const s=i.current.material;if(s&&"emissiveIntensity"in s){const r=a*3;s.emissiveIntensity=b.lerp(s.emissiveIntensity,r,.1)}}),e.jsxs("mesh",{ref:i,position:[0,-3,-2],rotation:[-Math.PI/2.5,0,0],children:[e.jsx("planeGeometry",{args:[20,15,32,32]}),e.jsx("meshPhysicalMaterial",{color:"#ec4899",emissive:"#ec4899",emissiveIntensity:.5,wireframe:!0,transparent:!0,opacity:.3,side:S})]})},N=({analyser:m,mode:u})=>{const i=p.useRef(),c=p.useMemo(()=>new Uint8Array(32),[]);return x(l=>{if(!i.current)return;let a=0;u==="mic"&&m?(m.getByteFrequencyData(c),a=c.slice(0,10).reduce((s,r)=>s+r,0)/10/255):a=(Math.sin(l.clock.elapsedTime*4)*.5+.5)*.8;const n=1+a*.5;i.current.scale.set(n,n,n);const t=i.current.material;t&&(t.emissiveIntensity=.5+a*2)}),e.jsxs("mesh",{ref:i,position:[0,0,0],children:[e.jsx("sphereGeometry",{args:[1.5,64,64]}),e.jsx("meshPhysicalMaterial",{color:"#7c3aed",emissive:"#4c1d95",roughness:.2,metalness:.8,clearcoat:1,clearcoatRoughness:.1})]})},W=()=>{const m=P(n=>n.startWarp),[u,i]=p.useState("demo"),c=T(u),{playClick:l,playHover:a}=C();return e.jsxs("group",{children:[e.jsx("color",{attach:"background",args:["#020617"]}),e.jsx("fogExp2",{attach:"fog",args:["#020617",.04]}),e.jsx(j,{preset:"city"}),e.jsx(v,{children:e.jsx(w,{position:[0,6,-5],fontSize:.6,color:"#d8b4fe",anchorX:"center",children:"SONIC GIANT [HARMONICS]"})}),e.jsx(A,{position:[0,3.5,0],center:!0,transform:!0,distanceFactor:5,style:{pointerEvents:"auto"},children:e.jsxs("div",{className:"flex gap-4 p-4 bg-black/80 rounded-xl border border-purple-500/30 backdrop-blur-md shadow-[0_0_30px_rgba(139,92,246,0.3)]",style:{pointerEvents:"auto"},children:[e.jsx("button",{onClick:()=>{l(),i("demo")},onPointerEnter:a,className:`px-4 py-1 rounded font-mono text-xs transition-all cursor-pointer ${u==="demo"?"bg-purple-600 text-white shadow-[0_0_15px_#7c3aed]":"text-purple-500 hover:bg-purple-900/50"}`,children:"DEMO_FREQUENCY"}),e.jsx("button",{onClick:()=>{l(),i("mic")},onPointerEnter:a,className:`px-4 py-1 rounded font-mono text-xs transition-all cursor-pointer ${u==="mic"?"bg-cyan-600 text-white shadow-[0_0_15px_#0891b2]":"text-cyan-500 hover:bg-cyan-900/50"}`,children:"LIVE_INPUT"}),e.jsx("button",{onClick:()=>{l(),m("hub")},onPointerEnter:a,className:"px-4 py-1 rounded font-mono text-xs border border-white/30 text-white/70 hover:bg-white/10 hover:border-white/50 hover:text-white transition-all shadow-lg cursor-pointer bg-black/50",children:"[ WARP TO NEXUS ]"})]})}),e.jsxs(E,{speed:2,rotationIntensity:.2,floatIntensity:.5,children:[e.jsx(N,{analyser:c,mode:u}),e.jsx(U,{analyser:c,mode:u})]}),e.jsx(F,{analyser:c,mode:u}),e.jsx(_,{analyser:c,mode:u}),e.jsx("gridHelper",{args:[50,50,8141549,1973067],position:[0,-4,0]})]})};export{W as default};
