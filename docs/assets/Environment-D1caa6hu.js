import{R as Ut,k as wr,l as Ot,S as Er,D as Nt,m as Hr,H as Se,F as Ue,n as ze,L as Re,o as er,p as Dt,q as Be,s as Pr,t as Bt,i as zr,W as Gr,U as cr,v as kt,w as Lt,x as gr,T as Ge,y as Ht,z as Pt,G as zt,J as Gt,K as Zt,N as fr,X as Wt,Y as $t,Z as Br,$ as Xt,a0 as lr,a1 as Yt,V as Ke,u as rr,r as ae,a2 as ur,a3 as Vt,a4 as qt,a5 as Kt,a6 as Jt,_ as Qt,a7 as jt,a as ea,a8 as ra,a9 as kr}from"./index-DIejhpZU.js";const Zr=parseInt(Ut.replace(/\D+/g,""));var ye=Uint8Array,ke=Uint16Array,mr=Uint32Array,Wr=new ye([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),$r=new ye([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ta=new ye([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Xr=function(i,t){for(var n=new ke(31),s=0;s<31;++s)n[s]=t+=1<<i[s-1];for(var u=new mr(n[30]),s=1;s<30;++s)for(var h=n[s];h<n[s+1];++h)u[h]=h-n[s]<<5|s;return[n,u]},Yr=Xr(Wr,2),Vr=Yr[0],aa=Yr[1];Vr[28]=258,aa[258]=28;var na=Xr($r,0),ia=na[0],_r=new ke(32768);for(var Q=0;Q<32768;++Q){var De=(Q&43690)>>>1|(Q&21845)<<1;De=(De&52428)>>>2|(De&13107)<<2,De=(De&61680)>>>4|(De&3855)<<4,_r[Q]=((De&65280)>>>8|(De&255)<<8)>>>1}var je=(function(i,t,n){for(var s=i.length,u=0,h=new ke(t);u<s;++u)++h[i[u]-1];var d=new ke(t);for(u=0;u<t;++u)d[u]=d[u-1]+h[u-1]<<1;var m;if(n){m=new ke(1<<t);var g=15-t;for(u=0;u<s;++u)if(i[u])for(var w=u<<4|i[u],F=t-i[u],R=d[i[u]-1]++<<F,C=R|(1<<F)-1;R<=C;++R)m[_r[R]>>>g]=w}else for(m=new ke(s),u=0;u<s;++u)i[u]&&(m[u]=_r[d[i[u]-1]++]>>>15-i[u]);return m}),ar=new ye(288);for(var Q=0;Q<144;++Q)ar[Q]=8;for(var Q=144;Q<256;++Q)ar[Q]=9;for(var Q=256;Q<280;++Q)ar[Q]=7;for(var Q=280;Q<288;++Q)ar[Q]=8;var qr=new ye(32);for(var Q=0;Q<32;++Q)qr[Q]=5;var oa=je(ar,9,1),sa=je(qr,5,1),pr=function(i){for(var t=i[0],n=1;n<i.length;++n)i[n]>t&&(t=i[n]);return t},Te=function(i,t,n){var s=t/8|0;return(i[s]|i[s+1]<<8)>>(t&7)&n},vr=function(i,t){var n=t/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(t&7)},la=function(i){return(i/8|0)+(i&7&&1)},ca=function(i,t,n){(n==null||n>i.length)&&(n=i.length);var s=new(i instanceof ke?ke:i instanceof mr?mr:ye)(n-t);return s.set(i.subarray(t,n)),s},ua=function(i,t,n){var s=i.length;if(!s||n&&!n.l&&s<5)return t||new ye(0);var u=!t||n,h=!n||n.i;n||(n={}),t||(t=new ye(s*3));var d=function($){var xe=t.length;if($>xe){var Ae=new ye(Math.max(xe*2,$));Ae.set(t),t=Ae}},m=n.f||0,g=n.p||0,w=n.b||0,F=n.l,R=n.d,C=n.m,L=n.n,G=s*8;do{if(!F){n.f=m=Te(i,g,1);var he=Te(i,g+1,3);if(g+=3,he)if(he==1)F=oa,R=sa,C=9,L=5;else if(he==2){var de=Te(i,g,31)+257,se=Te(i,g+10,15)+4,H=de+Te(i,g+5,31)+1;g+=14;for(var D=new ye(H),j=new ye(19),S=0;S<se;++S)j[ta[S]]=Te(i,g+S*3,7);g+=se*3;for(var I=pr(j),k=(1<<I)-1,Z=je(j,I,1),S=0;S<H;){var B=Z[Te(i,g,k)];g+=B&15;var W=B>>>4;if(W<16)D[S++]=W;else{var P=0,x=0;for(W==16?(x=3+Te(i,g,3),g+=2,P=D[S-1]):W==17?(x=3+Te(i,g,7),g+=3):W==18&&(x=11+Te(i,g,127),g+=7);x--;)D[S++]=P}}var ee=D.subarray(0,de),O=D.subarray(de);C=pr(ee),L=pr(O),F=je(ee,C,1),R=je(O,L,1)}else throw"invalid block type";else{var W=la(g)+4,ie=i[W-4]|i[W-3]<<8,oe=W+ie;if(oe>s){if(h)throw"unexpected EOF";break}u&&d(w+ie),t.set(i.subarray(W,oe),w),n.b=w+=ie,n.p=g=oe*8;continue}if(g>G){if(h)throw"unexpected EOF";break}}u&&d(w+131072);for(var Me=(1<<C)-1,Le=(1<<L)-1,Ie=g;;Ie=g){var P=F[vr(i,g)&Me],K=P>>>4;if(g+=P&15,g>G){if(h)throw"unexpected EOF";break}if(!P)throw"invalid length/literal";if(K<256)t[w++]=K;else if(K==256){Ie=g,F=null;break}else{var Oe=K-254;if(K>264){var S=K-257,re=Wr[S];Oe=Te(i,g,(1<<re)-1)+Vr[S],g+=re}var ue=R[vr(i,g)&Le],be=ue>>>4;if(!ue)throw"invalid distance";g+=ue&15;var O=ia[be];if(be>3){var re=$r[be];O+=vr(i,g)&(1<<re)-1,g+=re}if(g>G){if(h)throw"unexpected EOF";break}u&&d(w+131072);for(var We=w+Oe;w<We;w+=4)t[w]=t[w-O],t[w+1]=t[w+1-O],t[w+2]=t[w+2-O],t[w+3]=t[w+3-O];w=We}}n.l=F,n.p=Ie,n.b=w,F&&(m=1,n.m=C,n.d=R,n.n=L)}while(!m);return w==t.length?t:ca(t,0,w)},ha=new ye(0),da=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function or(i,t){return ua((da(i),i.subarray(2,-4)),t)}var pa=typeof TextDecoder<"u"&&new TextDecoder,va=0;try{pa.decode(ha,{stream:!0}),va=1}catch{}const ga=i=>i&&i.isCubeTexture;class fa extends wr{constructor(t,n){var s,u;const h=ga(t),m=((u=h?(s=t.image[0])==null?void 0:s.width:t.image.width)!=null?u:1024)/4,g=Math.floor(Math.log2(m)),w=Math.pow(2,g),F=3*Math.max(w,112),R=4*w,C=[h?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/F}`,`#define CUBEUV_TEXEL_HEIGHT ${1/R}`,`#define CUBEUV_MAX_MIP ${g}.0`],L=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,G=C.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Zr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,he={map:{value:t},height:{value:n?.height||15},radius:{value:n?.radius||100}},W=new Ot(1,16),ie=new Er({uniforms:he,fragmentShader:G,vertexShader:L,side:Nt});super(W,ie)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class ma extends Hr{constructor(t){super(t),this.type=Se}parse(t){const d=function(S,I){switch(S){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},R=function(S,I,k){I=I||1024;let B=S.pos,P=-1,x=0,ee="",O=String.fromCharCode.apply(null,new Uint16Array(S.subarray(B,B+128)));for(;0>(P=O.indexOf(`
`))&&x<I&&B<S.byteLength;)ee+=O,x+=O.length,B+=128,O+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(B,B+128)));return-1<P?(S.pos+=x+P+1,ee+O.slice(0,P)):!1},C=function(S){const I=/^#\?(\S+)/,k=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,B=/^\s*FORMAT=(\S+)\s*$/,P=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,x={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ee,O;for((S.pos>=S.byteLength||!(ee=R(S)))&&d(1,"no header found"),(O=ee.match(I))||d(3,"bad initial token"),x.valid|=1,x.programtype=O[1],x.string+=ee+`
`;ee=R(S),ee!==!1;){if(x.string+=ee+`
`,ee.charAt(0)==="#"){x.comments+=ee+`
`;continue}if((O=ee.match(k))&&(x.gamma=parseFloat(O[1])),(O=ee.match(Z))&&(x.exposure=parseFloat(O[1])),(O=ee.match(B))&&(x.valid|=2,x.format=O[1]),(O=ee.match(P))&&(x.valid|=4,x.height=parseInt(O[1],10),x.width=parseInt(O[2],10)),x.valid&2&&x.valid&4)break}return x.valid&2||d(3,"missing format specifier"),x.valid&4||d(3,"missing image size specifier"),x},L=function(S,I,k){const Z=I;if(Z<8||Z>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);Z!==(S[2]<<8|S[3])&&d(3,"wrong scanline width");const B=new Uint8Array(4*I*k);B.length||d(4,"unable to allocate buffer space");let P=0,x=0;const ee=4*Z,O=new Uint8Array(4),Me=new Uint8Array(ee);let Le=k;for(;Le>0&&x<S.byteLength;){x+4>S.byteLength&&d(1),O[0]=S[x++],O[1]=S[x++],O[2]=S[x++],O[3]=S[x++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=Z)&&d(3,"bad rgbe scanline format");let Ie=0,K;for(;Ie<ee&&x<S.byteLength;){K=S[x++];const re=K>128;if(re&&(K-=128),(K===0||Ie+K>ee)&&d(3,"bad scanline data"),re){const ue=S[x++];for(let be=0;be<K;be++)Me[Ie++]=ue}else Me.set(S.subarray(x,x+K),Ie),Ie+=K,x+=K}const Oe=Z;for(let re=0;re<Oe;re++){let ue=0;B[P]=Me[re+ue],ue+=Z,B[P+1]=Me[re+ue],ue+=Z,B[P+2]=Me[re+ue],ue+=Z,B[P+3]=Me[re+ue],P+=4}Le--}return B},G=function(S,I,k,Z){const B=S[I+3],P=Math.pow(2,B-128)/255;k[Z+0]=S[I+0]*P,k[Z+1]=S[I+1]*P,k[Z+2]=S[I+2]*P,k[Z+3]=1},he=function(S,I,k,Z){const B=S[I+3],P=Math.pow(2,B-128)/255;k[Z+0]=ze.toHalfFloat(Math.min(S[I+0]*P,65504)),k[Z+1]=ze.toHalfFloat(Math.min(S[I+1]*P,65504)),k[Z+2]=ze.toHalfFloat(Math.min(S[I+2]*P,65504)),k[Z+3]=ze.toHalfFloat(1)},W=new Uint8Array(t);W.pos=0;const ie=C(W),oe=ie.width,de=ie.height,se=L(W.subarray(W.pos),oe,de);let H,D,j;switch(this.type){case Ue:j=se.length/4;const S=new Float32Array(j*4);for(let k=0;k<j;k++)G(se,k*4,S,k*4);H=S,D=Ue;break;case Se:j=se.length/4;const I=new Uint16Array(j*4);for(let k=0;k<j;k++)he(se,k*4,I,k*4);H=I,D=Se;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:oe,height:de,data:H,header:ie.string,gamma:ie.gamma,exposure:ie.exposure,type:D}}setDataType(t){return this.type=t,this}load(t,n,s,u){function h(d,m){switch(d.type){case Ue:case Se:"colorSpace"in d?d.colorSpace="srgb-linear":d.encoding=3e3,d.minFilter=Re,d.magFilter=Re,d.generateMipmaps=!1,d.flipY=!0;break}n&&n(d,m)}return super.load(t,h,s,u)}}const Je=Zr>=152;class _a extends Hr{constructor(t){super(t),this.type=Se}parse(t){const I=Math.pow(2.7182818,2.2);function k(e,r){for(var a=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(r[a++]=o);for(var l=a-1;a<65536;)r[a++]=0;return l}function Z(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const B={l:0,c:0,lc:0};function P(e,r,a,o,l){for(;a<e;)r=r<<8|Nr(o,l),a+=8;a-=e,B.l=r>>a&(1<<e)-1,B.c=r,B.lc=a}const x=new Array(59);function ee(e){for(var r=0;r<=58;++r)x[r]=0;for(var r=0;r<65537;++r)x[e[r]]+=1;for(var a=0,r=58;r>0;--r){var o=a+x[r]>>1;x[r]=a,a=o}for(var r=0;r<65537;++r){var l=e[r];l>0&&(e[r]=l|x[l]++<<6)}}function O(e,r,a,o,l,c,v){for(var p=a,E=0,_=0;l<=c;l++){if(p.value-a.value>o)return!1;P(6,E,_,e,p);var y=B.l;if(E=B.c,_=B.lc,v[l]=y,y==63){if(p.value-a.value>o)throw"Something wrong with hufUnpackEncTable";P(8,E,_,e,p);var f=B.l+6;if(E=B.c,_=B.lc,l+f>c+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)v[l++]=0;l--}else if(y>=59){var f=y-59+2;if(l+f>c+1)throw"Something wrong with hufUnpackEncTable";for(;f--;)v[l++]=0;l--}}ee(v)}function Me(e){return e&63}function Le(e){return e>>6}function Ie(e,r,a,o){for(;r<=a;r++){var l=Le(e[r]),c=Me(e[r]);if(l>>c)throw"Invalid table entry";if(c>14){var v=o[l>>c-14];if(v.len)throw"Invalid table entry";if(v.lit++,v.p){var p=v.p;v.p=new Array(v.lit);for(var E=0;E<v.lit-1;++E)v.p[E]=p[E]}else v.p=new Array(1);v.p[v.lit-1]=r}else if(c)for(var _=0,E=1<<14-c;E>0;E--){var v=o[(l<<14-c)+_];if(v.len||v.p)throw"Invalid table entry";v.len=c,v.lit=r,_++}}return!0}const K={c:0,lc:0};function Oe(e,r,a,o){e=e<<8|Nr(a,o),r+=8,K.c=e,K.lc=r}const re={c:0,lc:0};function ue(e,r,a,o,l,c,v,p,E,_){if(e==r){o<8&&(Oe(a,o,l,v),a=K.c,o=K.lc),o-=8;var y=a>>o,y=new Uint8Array([y])[0];if(E.value+y>_)return!1;for(var f=p[E.value-1];y-- >0;)p[E.value++]=f}else if(E.value<_)p[E.value++]=e;else return!1;re.c=a,re.lc=o}function be(e){return e&65535}function We(e){var r=be(e);return r>32767?r-65536:r}const $={a:0,b:0};function xe(e,r){var a=We(e),o=We(r),l=o,c=a+(l&1)+(l>>1),v=c,p=c-l;$.a=v,$.b=p}function Ae(e,r){var a=be(e),o=be(r),l=a-(o>>1)&65535,c=o+l-32768&65535;$.a=c,$.b=l}function tt(e,r,a,o,l,c,v){for(var p=v<16384,E=a>l?l:a,_=1,y;_<=E;)_<<=1;for(_>>=1,y=_,_>>=1;_>=1;){for(var f=0,ne=f+c*(l-y),T=c*_,b=c*y,A=o*_,U=o*y,X,V,le,ge;f<=ne;f+=b){for(var q=f,Ce=f+o*(a-y);q<=Ce;q+=U){var J=q+A,ce=q+T,Fe=ce+A;p?(xe(e[q+r],e[ce+r]),X=$.a,le=$.b,xe(e[J+r],e[Fe+r]),V=$.a,ge=$.b,xe(X,V),e[q+r]=$.a,e[J+r]=$.b,xe(le,ge),e[ce+r]=$.a,e[Fe+r]=$.b):(Ae(e[q+r],e[ce+r]),X=$.a,le=$.b,Ae(e[J+r],e[Fe+r]),V=$.a,ge=$.b,Ae(X,V),e[q+r]=$.a,e[J+r]=$.b,Ae(le,ge),e[ce+r]=$.a,e[Fe+r]=$.b)}if(a&_){var ce=q+T;p?xe(e[q+r],e[ce+r]):Ae(e[q+r],e[ce+r]),X=$.a,e[ce+r]=$.b,e[q+r]=X}}if(l&_)for(var q=f,Ce=f+o*(a-y);q<=Ce;q+=U){var J=q+A;p?xe(e[q+r],e[J+r]):Ae(e[q+r],e[J+r]),X=$.a,e[J+r]=$.b,e[q+r]=X}y=_,_>>=1}return f}function at(e,r,a,o,l,c,v,p,E,_){for(var y=0,f=0,ne=p,T=Math.trunc(l.value+(c+7)/8);l.value<T;)for(Oe(y,f,a,l),y=K.c,f=K.lc;f>=14;){var b=y>>f-14&16383,A=r[b];if(A.len)f-=A.len,ue(A.lit,v,y,f,a,o,l,E,_,ne),y=re.c,f=re.lc;else{if(!A.p)throw"hufDecode issues";var U;for(U=0;U<A.lit;U++){for(var X=Me(e[A.p[U]]);f<X&&l.value<T;)Oe(y,f,a,l),y=K.c,f=K.lc;if(f>=X&&Le(e[A.p[U]])==(y>>f-X&(1<<X)-1)){f-=X,ue(A.p[U],v,y,f,a,o,l,E,_,ne),y=re.c,f=re.lc;break}}if(U==A.lit)throw"hufDecode issues"}}var V=8-c&7;for(y>>=V,f-=V;f>0;){var A=r[y<<14-f&16383];if(A.len)f-=A.len,ue(A.lit,v,y,f,a,o,l,E,_,ne),y=re.c,f=re.lc;else throw"hufDecode issues"}return!0}function Rr(e,r,a,o,l,c){var v={value:0},p=a.value,E=fe(r,a),_=fe(r,a);a.value+=4;var y=fe(r,a);if(a.value+=4,E<0||E>=65537||_<0||_>=65537)throw"Something wrong with HUF_ENCSIZE";var f=new Array(65537),ne=new Array(16384);Z(ne);var T=o-(a.value-p);if(O(e,r,a,T,E,_,f),y>8*(o-(a.value-p)))throw"Something wrong with hufUncompress";Ie(f,E,_,ne),at(f,ne,e,r,a,y,_,c,l,v)}function nt(e,r,a){for(var o=0;o<a;++o)r[o]=e[r[o]]}function xr(e){for(var r=1;r<e.length;r++){var a=e[r-1]+e[r]-128;e[r]=a}}function Ar(e,r){for(var a=0,o=Math.floor((e.length+1)/2),l=0,c=e.length-1;!(l>c||(r[l++]=e[a++],l>c));)r[l++]=e[o++]}function Fr(e){for(var r=e.byteLength,a=new Array,o=0,l=new DataView(e);r>0;){var c=l.getInt8(o++);if(c<0){var v=-c;r-=v+1;for(var p=0;p<v;p++)a.push(l.getUint8(o++))}else{var v=c;r-=2;for(var E=l.getUint8(o++),p=0;p<v+1;p++)a.push(E)}}return a}function it(e,r,a,o,l,c){var J=new DataView(c.buffer),v=a[e.idx[0]].width,p=a[e.idx[0]].height,E=3,_=Math.floor(v/8),y=Math.ceil(v/8),f=Math.ceil(p/8),ne=v-(y-1)*8,T=p-(f-1)*8,b={value:0},A=new Array(E),U=new Array(E),X=new Array(E),V=new Array(E),le=new Array(E);for(let Y=0;Y<E;++Y)le[Y]=r[e.idx[Y]],A[Y]=Y<1?0:A[Y-1]+y*f,U[Y]=new Float32Array(64),X[Y]=new Uint16Array(64),V[Y]=new Uint16Array(y*64);for(let Y=0;Y<f;++Y){var ge=8;Y==f-1&&(ge=T);var q=8;for(let te=0;te<y;++te){te==y-1&&(q=ne);for(let z=0;z<E;++z)X[z].fill(0),X[z][0]=l[A[z]++],ot(b,o,X[z]),st(X[z],U[z]),lt(U[z]);ct(U);for(let z=0;z<E;++z)ut(U[z],V[z],te*64)}let ve=0;for(let te=0;te<E;++te){const z=a[e.idx[te]].type;for(let Ee=8*Y;Ee<8*Y+ge;++Ee){ve=le[te][Ee];for(let He=0;He<_;++He){const me=He*64+(Ee&7)*8;J.setUint16(ve+0*z,V[te][me+0],!0),J.setUint16(ve+2*z,V[te][me+1],!0),J.setUint16(ve+4*z,V[te][me+2],!0),J.setUint16(ve+6*z,V[te][me+3],!0),J.setUint16(ve+8*z,V[te][me+4],!0),J.setUint16(ve+10*z,V[te][me+5],!0),J.setUint16(ve+12*z,V[te][me+6],!0),J.setUint16(ve+14*z,V[te][me+7],!0),ve+=16*z}}if(_!=y)for(let Ee=8*Y;Ee<8*Y+ge;++Ee){const He=le[te][Ee]+8*_*2*z,me=_*64+(Ee&7)*8;for(let Ne=0;Ne<q;++Ne)J.setUint16(He+Ne*2*z,V[te][me+Ne],!0)}}}for(var Ce=new Uint16Array(v),J=new DataView(c.buffer),ce=0;ce<E;++ce){a[e.idx[ce]].decoded=!0;var Fe=a[e.idx[ce]].type;if(a[ce].type==2)for(var qe=0;qe<p;++qe){const Y=le[ce][qe];for(var we=0;we<v;++we)Ce[we]=J.getUint16(Y+we*2*Fe,!0);for(var we=0;we<v;++we)J.setFloat32(Y+we*2*Fe,M(Ce[we]),!0)}}}function ot(e,r,a){for(var o,l=1;l<64;)o=r[e.value],o==65280?l=64:o>>8==255?l+=o&255:(a[l]=o,l++),e.value++}function st(e,r){r[0]=M(e[0]),r[1]=M(e[1]),r[2]=M(e[5]),r[3]=M(e[6]),r[4]=M(e[14]),r[5]=M(e[15]),r[6]=M(e[27]),r[7]=M(e[28]),r[8]=M(e[2]),r[9]=M(e[4]),r[10]=M(e[7]),r[11]=M(e[13]),r[12]=M(e[16]),r[13]=M(e[26]),r[14]=M(e[29]),r[15]=M(e[42]),r[16]=M(e[3]),r[17]=M(e[8]),r[18]=M(e[12]),r[19]=M(e[17]),r[20]=M(e[25]),r[21]=M(e[30]),r[22]=M(e[41]),r[23]=M(e[43]),r[24]=M(e[9]),r[25]=M(e[11]),r[26]=M(e[18]),r[27]=M(e[24]),r[28]=M(e[31]),r[29]=M(e[40]),r[30]=M(e[44]),r[31]=M(e[53]),r[32]=M(e[10]),r[33]=M(e[19]),r[34]=M(e[23]),r[35]=M(e[32]),r[36]=M(e[39]),r[37]=M(e[45]),r[38]=M(e[52]),r[39]=M(e[54]),r[40]=M(e[20]),r[41]=M(e[22]),r[42]=M(e[33]),r[43]=M(e[38]),r[44]=M(e[46]),r[45]=M(e[51]),r[46]=M(e[55]),r[47]=M(e[60]),r[48]=M(e[21]),r[49]=M(e[34]),r[50]=M(e[37]),r[51]=M(e[47]),r[52]=M(e[50]),r[53]=M(e[56]),r[54]=M(e[59]),r[55]=M(e[61]),r[56]=M(e[35]),r[57]=M(e[36]),r[58]=M(e[48]),r[59]=M(e[49]),r[60]=M(e[57]),r[61]=M(e[58]),r[62]=M(e[62]),r[63]=M(e[63])}function lt(e){const r=.5*Math.cos(.7853975),a=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),l=.5*Math.cos(3*3.14159/16),c=.5*Math.cos(5*3.14159/16),v=.5*Math.cos(3*3.14159/8),p=.5*Math.cos(7*3.14159/16);for(var E=new Array(4),_=new Array(4),y=new Array(4),f=new Array(4),ne=0;ne<8;++ne){var T=ne*8;E[0]=o*e[T+2],E[1]=v*e[T+2],E[2]=o*e[T+6],E[3]=v*e[T+6],_[0]=a*e[T+1]+l*e[T+3]+c*e[T+5]+p*e[T+7],_[1]=l*e[T+1]-p*e[T+3]-a*e[T+5]-c*e[T+7],_[2]=c*e[T+1]-a*e[T+3]+p*e[T+5]+l*e[T+7],_[3]=p*e[T+1]-c*e[T+3]+l*e[T+5]-a*e[T+7],y[0]=r*(e[T+0]+e[T+4]),y[3]=r*(e[T+0]-e[T+4]),y[1]=E[0]+E[3],y[2]=E[1]-E[2],f[0]=y[0]+y[1],f[1]=y[3]+y[2],f[2]=y[3]-y[2],f[3]=y[0]-y[1],e[T+0]=f[0]+_[0],e[T+1]=f[1]+_[1],e[T+2]=f[2]+_[2],e[T+3]=f[3]+_[3],e[T+4]=f[3]-_[3],e[T+5]=f[2]-_[2],e[T+6]=f[1]-_[1],e[T+7]=f[0]-_[0]}for(var b=0;b<8;++b)E[0]=o*e[16+b],E[1]=v*e[16+b],E[2]=o*e[48+b],E[3]=v*e[48+b],_[0]=a*e[8+b]+l*e[24+b]+c*e[40+b]+p*e[56+b],_[1]=l*e[8+b]-p*e[24+b]-a*e[40+b]-c*e[56+b],_[2]=c*e[8+b]-a*e[24+b]+p*e[40+b]+l*e[56+b],_[3]=p*e[8+b]-c*e[24+b]+l*e[40+b]-a*e[56+b],y[0]=r*(e[b]+e[32+b]),y[3]=r*(e[b]-e[32+b]),y[1]=E[0]+E[3],y[2]=E[1]-E[2],f[0]=y[0]+y[1],f[1]=y[3]+y[2],f[2]=y[3]-y[2],f[3]=y[0]-y[1],e[0+b]=f[0]+_[0],e[8+b]=f[1]+_[1],e[16+b]=f[2]+_[2],e[24+b]=f[3]+_[3],e[32+b]=f[3]-_[3],e[40+b]=f[2]-_[2],e[48+b]=f[1]-_[1],e[56+b]=f[0]-_[0]}function ct(e){for(var r=0;r<64;++r){var a=e[0][r],o=e[1][r],l=e[2][r];e[0][r]=a+1.5747*l,e[1][r]=a-.1873*o-.4682*l,e[2][r]=a+1.8556*o}}function ut(e,r,a){for(var o=0;o<64;++o)r[a+o]=ze.toHalfFloat(ht(e[o]))}function ht(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(I,Math.abs(e)-1)}function Ur(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function dt(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),a=new Uint8Array(Fr(r)),o=new Uint8Array(a.length);return xr(a),Ar(a,o),new DataView(o.buffer)}function dr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=or(r),o=new Uint8Array(a.length);return xr(a),Ar(a,o),new DataView(o.buffer)}function pt(e){for(var r=e.viewer,a={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),l=new Uint8Array(8192),c=0,v=new Array(e.channels),p=0;p<e.channels;p++)v[p]={},v[p].start=c,v[p].end=v[p].start,v[p].nx=e.width,v[p].ny=e.lines,v[p].size=e.type,c+=v[p].nx*v[p].ny*v[p].size;var E=Xe(r,a),_=Xe(r,a);if(_>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(E<=_)for(var p=0;p<_-E+1;p++)l[p+E]=Pe(r,a);var y=new Uint16Array(65536),f=k(l,y),ne=fe(r,a);Rr(e.array,r,a,ne,o,c);for(var p=0;p<e.channels;++p)for(var T=v[p],b=0;b<v[p].size;++b)tt(o,T.start+b,T.nx,T.size,T.ny,T.nx*T.size,f);nt(y,o,c);for(var A=0,U=new Uint8Array(o.buffer.byteLength),X=0;X<e.lines;X++)for(var V=0;V<e.channels;V++){var T=v[V],le=T.nx*T.size,ge=new Uint8Array(o.buffer,T.end*2,le*2);U.set(ge,A),A+=le*2,T.end+=le}return new DataView(U.buffer)}function vt(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=or(r);const o=e.lines*e.channels*e.width,l=e.type==1?new Uint16Array(o):new Uint32Array(o);let c=0,v=0;const p=new Array(4);for(let E=0;E<e.lines;E++)for(let _=0;_<e.channels;_++){let y=0;switch(e.type){case 1:p[0]=c,p[1]=p[0]+e.width,c=p[1]+e.width;for(let f=0;f<e.width;++f){const ne=a[p[0]++]<<8|a[p[1]++];y+=ne,l[v]=y,v++}break;case 2:p[0]=c,p[1]=p[0]+e.width,p[2]=p[1]+e.width,c=p[2]+e.width;for(let f=0;f<e.width;++f){const ne=a[p[0]++]<<24|a[p[1]++]<<16|a[p[2]++]<<8;y+=ne,l[v]=y,v++}break}}return new DataView(l.buffer)}function Or(e){var r=e.viewer,a={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),l={version:_e(r,a),unknownUncompressedSize:_e(r,a),unknownCompressedSize:_e(r,a),acCompressedSize:_e(r,a),dcCompressedSize:_e(r,a),rleCompressedSize:_e(r,a),rleUncompressedSize:_e(r,a),rleRawSize:_e(r,a),totalAcUncompressedCount:_e(r,a),totalDcUncompressedCount:_e(r,a),acCompression:_e(r,a)};if(l.version<2)throw"EXRLoader.parse: "+Ve.compression+" version "+l.version+" is unsupported";for(var c=new Array,v=Xe(r,a)-2;v>0;){var p=nr(r.buffer,a),E=Pe(r,a),_=E>>2&3,y=(E>>4)-1,f=new Int8Array([y])[0],ne=Pe(r,a);c.push({name:p,index:f,type:ne,compression:_}),v-=p.length+3}for(var T=Ve.channels,b=new Array(e.channels),A=0;A<e.channels;++A){var U=b[A]={},X=T[A];U.name=X.name,U.compression=0,U.decoded=!1,U.type=X.pixelType,U.pLinear=X.pLinear,U.width=e.width,U.height=e.lines}for(var V={idx:new Array(3)},le=0;le<e.channels;++le)for(var U=b[le],A=0;A<c.length;++A){var ge=c[A];U.name==ge.name&&(U.compression=ge.compression,ge.index>=0&&(V.idx[ge.index]=le),U.offset=le)}if(l.acCompressedSize>0)switch(l.acCompression){case 0:var J=new Uint16Array(l.totalAcUncompressedCount);Rr(e.array,r,a,l.acCompressedSize,J,l.totalAcUncompressedCount);break;case 1:var q=e.array.slice(a.value,a.value+l.totalAcUncompressedCount),Ce=or(q),J=new Uint16Array(Ce.buffer);a.value+=l.totalAcUncompressedCount;break}if(l.dcCompressedSize>0){var ce={array:e.array,offset:a,size:l.dcCompressedSize},Fe=new Uint16Array(dr(ce).buffer);a.value+=l.dcCompressedSize}if(l.rleRawSize>0){var q=e.array.slice(a.value,a.value+l.rleCompressedSize),Ce=or(q),qe=Fr(Ce.buffer);a.value+=l.rleCompressedSize}for(var we=0,Y=new Array(b.length),A=0;A<Y.length;++A)Y[A]=new Array;for(var ve=0;ve<e.lines;++ve)for(var te=0;te<b.length;++te)Y[te].push(we),we+=b[te].width*e.type*2;it(V,Y,b,J,Fe,o);for(var A=0;A<b.length;++A){var U=b[A];if(!U.decoded)switch(U.compression){case 2:for(var z=0,Ee=0,ve=0;ve<e.lines;++ve){for(var He=Y[A][z],me=0;me<U.width;++me){for(var Ne=0;Ne<2*U.type;++Ne)o[He++]=qe[Ee+Ne*U.width*U.height];Ee++}z++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function nr(e,r){for(var a=new Uint8Array(e),o=0;a[r.value+o]!=0;)o+=1;var l=new TextDecoder().decode(a.slice(r.value,r.value+o));return r.value=r.value+o+1,l}function gt(e,r,a){var o=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+a));return r.value=r.value+a,o}function ft(e,r){var a=$e(e,r),o=fe(e,r);return[a,o]}function mt(e,r){var a=fe(e,r),o=fe(e,r);return[a,o]}function $e(e,r){var a=e.getInt32(r.value,!0);return r.value=r.value+4,a}function fe(e,r){var a=e.getUint32(r.value,!0);return r.value=r.value+4,a}function Nr(e,r){var a=e[r.value];return r.value=r.value+1,a}function Pe(e,r){var a=e.getUint8(r.value);return r.value=r.value+1,a}const _e=function(e,r){let a;return"getBigInt64"in DataView.prototype?a=Number(e.getBigInt64(r.value,!0)):a=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,a};function pe(e,r){var a=e.getFloat32(r.value,!0);return r.value+=4,a}function _t(e,r){return ze.toHalfFloat(pe(e,r))}function M(e){var r=(e&31744)>>10,a=e&1023;return(e>>15?-1:1)*(r?r===31?a?NaN:1/0:Math.pow(2,r-15)*(1+a/1024):6103515625e-14*(a/1024))}function Xe(e,r){var a=e.getUint16(r.value,!0);return r.value+=2,a}function wt(e,r){return M(Xe(e,r))}function Et(e,r,a,o){for(var l=a.value,c=[];a.value<l+o-1;){var v=nr(r,a),p=$e(e,a),E=Pe(e,a);a.value+=3;var _=$e(e,a),y=$e(e,a);c.push({name:v,pixelType:p,pLinear:E,xSampling:_,ySampling:y})}return a.value+=1,c}function yt(e,r){var a=pe(e,r),o=pe(e,r),l=pe(e,r),c=pe(e,r),v=pe(e,r),p=pe(e,r),E=pe(e,r),_=pe(e,r);return{redX:a,redY:o,greenX:l,greenY:c,blueX:v,blueY:p,whiteX:E,whiteY:_}}function St(e,r){var a=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=Pe(e,r);return a[o]}function Mt(e,r){var a=fe(e,r),o=fe(e,r),l=fe(e,r),c=fe(e,r);return{xMin:a,yMin:o,xMax:l,yMax:c}}function It(e,r){var a=["INCREASING_Y"],o=Pe(e,r);return a[o]}function Tt(e,r){var a=pe(e,r),o=pe(e,r);return[a,o]}function bt(e,r){var a=pe(e,r),o=pe(e,r),l=pe(e,r);return[a,o,l]}function Ct(e,r,a,o,l){if(o==="string"||o==="stringvector"||o==="iccProfile")return gt(r,a,l);if(o==="chlist")return Et(e,r,a,l);if(o==="chromaticities")return yt(e,a);if(o==="compression")return St(e,a);if(o==="box2i")return Mt(e,a);if(o==="lineOrder")return It(e,a);if(o==="float")return pe(e,a);if(o==="v2f")return Tt(e,a);if(o==="v3f")return bt(e,a);if(o==="int")return $e(e,a);if(o==="rational")return ft(e,a);if(o==="timecode")return mt(e,a);if(o==="preview")return a.value+=l,"skipped";a.value+=l}function Rt(e,r,a){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const l=e.getUint8(5);o.spec={singleTile:!!(l&2),longName:!!(l&4),deepFormat:!!(l&8),multiPart:!!(l&16)},a.value=8;for(var c=!0;c;){var v=nr(r,a);if(v==0)c=!1;else{var p=nr(r,a),E=fe(e,a),_=Ct(e,r,a,p,E);_===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${p}'.`):o[v]=_}}if((l&-5)!=0)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function xt(e,r,a,o,l){const c={size:0,viewer:r,array:a,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Je?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":c.lines=1,c.uncompress=Ur;break;case"RLE_COMPRESSION":c.lines=1,c.uncompress=dt;break;case"ZIPS_COMPRESSION":c.lines=1,c.uncompress=dr;break;case"ZIP_COMPRESSION":c.lines=16,c.uncompress=dr;break;case"PIZ_COMPRESSION":c.lines=32,c.uncompress=pt;break;case"PXR24_COMPRESSION":c.lines=16,c.uncompress=vt;break;case"DWAA_COMPRESSION":c.lines=32,c.uncompress=Or;break;case"DWAB_COMPRESSION":c.lines=256,c.uncompress=Or;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(c.scanlineBlockSize=c.lines,c.type==1)switch(l){case Ue:c.getter=wt,c.inputSize=2;break;case Se:c.getter=Xe,c.inputSize=2;break}else if(c.type==2)switch(l){case Ue:c.getter=pe,c.inputSize=4;break;case Se:c.getter=_t,c.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+c.type+" for "+e.compression+".";c.blockCount=(e.dataWindow.yMax+1)/c.scanlineBlockSize;for(var v=0;v<c.blockCount;v++)_e(r,o);c.outputChannels=c.channels==3?4:c.channels;const p=c.width*c.height*c.outputChannels;switch(l){case Ue:c.byteArray=new Float32Array(p),c.channels<c.outputChannels&&c.byteArray.fill(1,0,p);break;case Se:c.byteArray=new Uint16Array(p),c.channels<c.outputChannels&&c.byteArray.fill(15360,0,p);break;default:console.error("THREE.EXRLoader: unsupported type: ",l);break}return c.bytesPerLine=c.width*c.inputSize*c.channels,c.outputChannels==4?c.format=er:c.format=Dt,Je?c.colorSpace="srgb-linear":c.encoding=3e3,c}const ir=new DataView(t),At=new Uint8Array(t),Ye={value:0},Ve=Rt(ir,t,Ye),N=xt(Ve,ir,At,Ye,this.type),Dr={value:0},Ft={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<N.height/N.scanlineBlockSize;e++){const r=fe(ir,Ye);N.size=fe(ir,Ye),N.lines=r+N.scanlineBlockSize>N.height?N.height-r:N.scanlineBlockSize;const o=N.size<N.lines*N.bytesPerLine?N.uncompress(N):Ur(N);Ye.value+=N.size;for(let l=0;l<N.scanlineBlockSize;l++){const c=l+e*N.scanlineBlockSize;if(c>=N.height)break;for(let v=0;v<N.channels;v++){const p=Ft[Ve.channels[v].name];for(let E=0;E<N.width;E++){Dr.value=(l*(N.channels*N.width)+v*N.width+E)*N.inputSize;const _=(N.height-1-c)*(N.width*N.outputChannels)+E*N.outputChannels+p;N.byteArray[_]=N.getter(o,Dr)}}}}return{header:Ve,width:N.width,height:N.height,data:N.byteArray,format:N.format,[Je?"colorSpace":"encoding"]:N[Je?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,n,s,u){function h(d,m){Je?d.colorSpace=m.colorSpace:d.encoding=m.encoding,d.minFilter=Re,d.magFilter=Re,d.generateMipmaps=!1,d.flipY=!1,n&&n(d,m)}return super.load(t,h,s,u)}}const wa=3e3,Ea=3001,Kr=(i,t,n)=>{let s;switch(i){case fr:s=new Uint8ClampedArray(t*n*4);break;case Se:s=new Uint16Array(t*n*4);break;case Zt:s=new Uint32Array(t*n*4);break;case Gt:s=new Int8Array(t*n*4);break;case zt:s=new Int16Array(t*n*4);break;case Pt:s=new Int32Array(t*n*4);break;case Ue:s=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return s};let sr;const ya=(i,t,n,s)=>{if(sr!==void 0)return sr;const u=new Gr(1,1,s);t.setRenderTarget(u);const h=new wr(new zr,new Ht({color:16777215}));t.render(h,n),t.setRenderTarget(null);const d=Kr(i,u.width,u.height);return t.readRenderTargetPixels(u,0,0,u.width,u.height,d),u.dispose(),h.geometry.dispose(),h.material.dispose(),sr=d[0]!==0,sr};class yr{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(t){this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const n={format:er,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:t.renderTargetOptions?.anisotropy!==void 0?t.renderTargetOptions?.anisotropy:1,generateMipmaps:t.renderTargetOptions?.generateMipmaps!==void 0?t.renderTargetOptions?.generateMipmaps:!1,magFilter:t.renderTargetOptions?.magFilter!==void 0?t.renderTargetOptions?.magFilter:Re,minFilter:t.renderTargetOptions?.minFilter!==void 0?t.renderTargetOptions?.minFilter:Re,samples:t.renderTargetOptions?.samples!==void 0?t.renderTargetOptions?.samples:void 0,wrapS:t.renderTargetOptions?.wrapS!==void 0?t.renderTargetOptions?.wrapS:Be,wrapT:t.renderTargetOptions?.wrapT!==void 0?t.renderTargetOptions?.wrapT:Be};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=yr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Pr,this._camera=new Bt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!ya(this._type,this._renderer,this._camera,n)){let s;switch(this._type){case Se:s=this._renderer.extensions.has("EXT_color_buffer_float")?Ue:void 0;break}s!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ue}`),this._type=s):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new wr(new zr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new Gr(this.width,this.height,n),this._renderTarget.texture.mapping=t.renderTargetOptions?.mapping!==void 0?t.renderTargetOptions?.mapping:cr}static instantiateRenderer(){const t=new kt;return t.setSize(128,128),t}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(t){throw this._renderer.setRenderTarget(null),t}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=Kr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const n=new Lt(this.toArray(),this.width,this.height,er,this._type,t?.mapping||cr,t?.wrapS||Be,t?.wrapT||Be,t?.magFilter||Re,t?.minFilter||Re,t?.anisotropy||1,gr);return n.generateMipmaps=t?.generateMipmaps!==void 0?t?.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof Er&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof Ge&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof Ge&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class Jr extends Error{}class Qr extends Error{}const Qe=(i,t,n)=>{const s=new RegExp(`${t}="([^"]*)"`,"i").exec(i);if(s)return s[1];const u=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(i);if(u){const h=u[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return h&&h.length===3?h.map(d=>d.replace(/<\/?rdf:li>/g,"")):u[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${t} in gainmap metadata`)},Sa=i=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(i):t=i.toString();let n=t.indexOf("<x:xmpmeta");for(;n!==-1;){const s=t.indexOf("x:xmpmeta>",n),u=t.slice(n,s+10);try{const h=Qe(u,"hdrgm:GainMapMin","0"),d=Qe(u,"hdrgm:GainMapMax"),m=Qe(u,"hdrgm:Gamma","1"),g=Qe(u,"hdrgm:OffsetSDR","0.015625"),w=Qe(u,"hdrgm:OffsetHDR","0.015625"),F=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(u),R=F?F[1]:"0",C=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(u);if(!C)throw new Error("Incomplete gainmap metadata");const L=C[1];return{gainMapMin:Array.isArray(h)?h.map(G=>parseFloat(G)):[parseFloat(h),parseFloat(h),parseFloat(h)],gainMapMax:Array.isArray(d)?d.map(G=>parseFloat(G)):[parseFloat(d),parseFloat(d),parseFloat(d)],gamma:Array.isArray(m)?m.map(G=>parseFloat(G)):[parseFloat(m),parseFloat(m),parseFloat(m)],offsetSdr:Array.isArray(g)?g.map(G=>parseFloat(G)):[parseFloat(g),parseFloat(g),parseFloat(g)],offsetHdr:Array.isArray(w)?w.map(G=>parseFloat(G)):[parseFloat(w),parseFloat(w),parseFloat(w)],hdrCapacityMin:parseFloat(R),hdrCapacityMax:parseFloat(L)}}catch{}n=t.indexOf("<x:xmpmeta",s)}};class Ma{options;constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((n,s)=>{const u=this.options.debug,h=new DataView(t.buffer);if(h.getUint16(0)!==65496){s(new Error("Not a valid jpeg"));return}const d=h.byteLength;let m=2,g=0,w;for(;m<d;){if(++g>250){s(new Error(`Found no marker after ${g} loops ðŸ˜µ`));return}if(h.getUint8(m)!==255){s(new Error(`Not a valid marker at offset 0x${m.toString(16)}, found: 0x${h.getUint8(m).toString(16)}`));return}if(w=h.getUint8(m+1),u&&console.log(`Marker: ${w.toString(16)}`),w===226){u&&console.log("Found APP2 marker (0xffe2)");const F=m+4;if(h.getUint32(F)===1297106432){const R=F+4;let C;if(h.getUint16(R)===18761)C=!1;else if(h.getUint16(R)===19789)C=!0;else{s(new Error("No valid endianness marker found in TIFF header"));return}if(h.getUint16(R+2,!C)!==42){s(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const L=h.getUint32(R+4,!C);if(L<8){s(new Error("Not valid TIFF data! (First offset less than 8)"));return}const G=R+L,he=h.getUint16(G,!C),W=G+2;let ie=0;for(let H=W;H<W+12*he;H+=12)h.getUint16(H,!C)===45057&&(ie=h.getUint32(H+8,!C));const de=G+2+he*12+4,se=[];for(let H=de;H<de+ie*16;H+=16){const D={MPType:h.getUint32(H,!C),size:h.getUint32(H+4,!C),dataOffset:h.getUint32(H+8,!C),dependantImages:h.getUint32(H+12,!C),start:-1,end:-1,isFII:!1};D.dataOffset?(D.start=R+D.dataOffset,D.isFII=!1):(D.start=0,D.isFII=!0),D.end=D.start+D.size,se.push(D)}if(this.options.extractNonFII&&se.length){const H=new Blob([h]),D=[];for(const j of se){if(j.isFII&&!this.options.extractFII)continue;const S=H.slice(j.start,j.end+1,"image/jpeg");D.push(S)}n(D)}}}m+=2+h.getUint16(m+2)}})}}const Ia=async i=>{const t=Sa(i);if(!t)throw new Qr("Gain map XMP metadata not found");const s=await new Ma({extractFII:!0,extractNonFII:!0}).extract(i);if(s.length!==2)throw new Jr("Gain map recovery image not found");return{sdr:new Uint8Array(await s[0].arrayBuffer()),gainMap:new Uint8Array(await s[1].arrayBuffer()),metadata:t}},Lr=i=>new Promise((t,n)=>{const s=document.createElement("img");s.onload=()=>{t(s)},s.onerror=u=>{n(u)},s.src=URL.createObjectURL(i)});class Ta extends Wt{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(t,n){super(n),this._config=t,t.renderer&&(this._renderer=t.renderer),this._internalLoadingManager=new $t}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new Ge,sdr:new Ge});return this._config.createQuadRenderer({width:16,height:16,type:Se,colorSpace:gr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(t,n,s){const u=n?new Blob([n],{type:"image/jpeg"}):void 0,h=new Blob([t],{type:"image/jpeg"});let d,m,g=!1;if(typeof createImageBitmap>"u"){const w=await Promise.all([u?Lr(u):Promise.resolve(void 0),Lr(h)]);m=w[0],d=w[1],g=s==="flipY"}else{const w=await Promise.all([u?createImageBitmap(u,{imageOrientation:s||"flipY"}):Promise.resolve(void 0),createImageBitmap(h,{imageOrientation:s||"flipY"})]);m=w[0],d=w[1]}return{sdrImage:d,gainMapImage:m,needsFlip:g}}createTextures(t,n,s){const u=new Ge(n||new ImageData(2,2),cr,Be,Be,Re,Br,er,fr,1,gr);u.flipY=s,u.needsUpdate=!0;const h=new Ge(t,cr,Be,Be,Re,Br,er,fr,1,Xt);return h.flipY=s,h.needsUpdate=!0,{gainMap:u,sdr:h}}updateQuadRenderer(t,n,s,u,h){t.width=n.width,t.height=n.height,t.material.gainMap=s,t.material.sdr=u,t.material.gainMapMin=h.gainMapMin,t.material.gainMapMax=h.gainMapMax,t.material.offsetHdr=h.offsetHdr,t.material.offsetSdr=h.offsetSdr,t.material.gamma=h.gamma,t.material.hdrCapacityMin=h.hdrCapacityMin,t.material.hdrCapacityMax=h.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,h.hdrCapacityMax),t.material.needsUpdate=!0}}const ba=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,Ca=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ra extends Er{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:t,offsetHdr:n,offsetSdr:s,gainMapMin:u,gainMapMax:h,maxDisplayBoost:d,hdrCapacityMin:m,hdrCapacityMax:g,sdr:w,gainMap:F}){super({name:"GainMapDecoderMaterial",vertexShader:ba,fragmentShader:Ca,uniforms:{sdr:{value:w},gainMap:{value:F},gamma:{value:new Ke(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Ke().fromArray(n)},offsetSdr:{value:new Ke().fromArray(s)},gainMapMin:{value:new Ke().fromArray(u)},gainMapMax:{value:new Ke().fromArray(h)},weightFactor:{value:(Math.log2(d)-m)/(g-m)}},blending:Yt,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=d,this._hdrCapacityMin=m,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const n=this.uniforms.gamma.value;n.x=1/t[0],n.y=1/t[1],n.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class jr extends Ta{constructor(t,n){super({renderer:t,createMaterial:s=>new Ra(s),createQuadRenderer:s=>new yr(s)},n)}async render(t,n,s,u){const{sdrImage:h,gainMapImage:d,needsFlip:m}=await this.processImages(s,u,"flipY"),{gainMap:g,sdr:w}=this.createTextures(h,d,m);this.updateQuadRenderer(t,h,g,w,n),t.render()}}class xa extends jr{load([t,n,s],u,h,d){const m=this.prepareQuadRenderer();let g,w,F;const R=async()=>{if(g&&w&&F){try{await this.render(m,F,g,w)}catch(I){this.manager.itemError(t),this.manager.itemError(n),this.manager.itemError(s),typeof d=="function"&&d(I),m.disposeOnDemandRenderer();return}typeof u=="function"&&u(m),this.manager.itemEnd(t),this.manager.itemEnd(n),this.manager.itemEnd(s),m.disposeOnDemandRenderer()}};let C=!0,L=0,G=0,he=!0,W=0,ie=0,oe=!0,de=0,se=0;const H=()=>{if(typeof h=="function"){const I=L+W+de,k=G+ie+se,Z=C&&he&&oe;h(new ProgressEvent("progress",{lengthComputable:Z,loaded:k,total:I}))}};this.manager.itemStart(t),this.manager.itemStart(n),this.manager.itemStart(s);const D=new lr(this._internalLoadingManager);D.setResponseType("arraybuffer"),D.setRequestHeader(this.requestHeader),D.setPath(this.path),D.setWithCredentials(this.withCredentials),D.load(t,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");g=I,await R()},I=>{C=I.lengthComputable,G=I.loaded,L=I.total,H()},I=>{this.manager.itemError(t),typeof d=="function"&&d(I)});const j=new lr(this._internalLoadingManager);j.setResponseType("arraybuffer"),j.setRequestHeader(this.requestHeader),j.setPath(this.path),j.setWithCredentials(this.withCredentials),j.load(n,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");w=I,await R()},I=>{he=I.lengthComputable,ie=I.loaded,W=I.total,H()},I=>{this.manager.itemError(n),typeof d=="function"&&d(I)});const S=new lr(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(s,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");F=JSON.parse(I),await R()},I=>{oe=I.lengthComputable,se=I.loaded,de=I.total,H()},I=>{this.manager.itemError(s),typeof d=="function"&&d(I)}),m}}class Aa extends jr{load(t,n,s,u){const h=this.prepareQuadRenderer(),d=new lr(this._internalLoadingManager);return d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setPath(this.path),d.setWithCredentials(this.withCredentials),this.manager.itemStart(t),d.load(t,async m=>{if(typeof m=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const g=new Uint8Array(m);let w,F,R;try{const C=await Ia(g);w=C.sdr,F=C.gainMap,R=C.metadata}catch(C){if(C instanceof Qr||C instanceof Jr)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),R={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},w=g;else throw C}try{await this.render(h,R,w.buffer,F?.buffer)}catch(C){this.manager.itemError(t),typeof u=="function"&&u(C),h.disposeOnDemandRenderer();return}typeof n=="function"&&n(h),this.manager.itemEnd(t),h.disposeOnDemandRenderer()},s,m=>{this.manager.itemError(t),typeof u=="function"&&u(m)}),h}}const tr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},et="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",Ze=i=>Array.isArray(i),Sr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function hr({files:i=Sr,path:t="",preset:n=void 0,encoding:s=void 0,extensions:u}={}){let h=null,d=!1;n&&(Mr(n),i=tr[n],t=et),d=Ze(i);const{extension:m,isCubemap:g}=Ir(i);if(h=Tr(m),!h)throw new Error("useEnvironment: Unrecognized file extension: "+i);const w=rr(L=>L.gl);ae.useLayoutEffect(()=>{if(m!=="webp"&&m!=="jpg"&&m!=="jpeg")return;function L(){ur.clear(h,d?[i]:i)}w.domElement.addEventListener("webglcontextlost",L,{once:!0})},[i,w.domElement]);const F=ur(h,d?[i]:i,L=>{(m==="webp"||m==="jpg"||m==="jpeg")&&L.setRenderer(w),L.setPath==null||L.setPath(t),u&&u(L)});let R=d?F[0]:F;if(m==="jpg"||m==="jpeg"||m==="webp"){var C;R=(C=R.renderTarget)==null?void 0:C.texture}return R.mapping=g?Vt:qt,"colorSpace"in R?R.colorSpace=s??g?"srgb":"srgb-linear":R.encoding=s??g?Ea:wa,R}const Fa={files:Sr,path:"",preset:void 0,extensions:void 0};hr.preload=i=>{const t={...Fa,...i};let{files:n,path:s=""}=t;const{preset:u,extensions:h}=t;u&&(Mr(u),n=tr[u],s=et);const{extension:d}=Ir(n);if(d==="webp"||d==="jpg"||d==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const m=Tr(d);if(!m)throw new Error("useEnvironment: Unrecognized file extension: "+n);ur.preload(m,Ze(n)?[n]:n,g=>{g.setPath==null||g.setPath(s),h&&h(g)})};const Ua={files:Sr,preset:void 0};hr.clear=i=>{const t={...Ua,...i};let{files:n}=t;const{preset:s}=t;s&&(Mr(s),n=tr[s]);const{extension:u}=Ir(n),h=Tr(u);if(!h)throw new Error("useEnvironment: Unrecognized file extension: "+n);ur.clear(h,Ze(n)?[n]:n)};function Mr(i){if(!(i in tr))throw new Error("Preset must be one of: "+Object.keys(tr).join(", "))}function Ir(i){var t;const n=Ze(i)&&i.length===6,s=Ze(i)&&i.length===3&&i.some(d=>d.endsWith("json")),u=Ze(i)?i[0]:i;return{extension:n?"cube":s?"webp":u.startsWith("data:application/exr")?"exr":u.startsWith("data:application/hdr")?"hdr":u.startsWith("data:image/jpeg")?"jpg":(t=u.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:n,isGainmap:s}}function Tr(i){return i==="cube"?Kt:i==="hdr"?ma:i==="exr"?_a:i==="jpg"||i==="jpeg"?Aa:i==="webp"?xa:null}const Oa=i=>i.current&&i.current.isScene,Na=i=>Oa(i)?i.current:i;function br(i,t,n,s,u={}){var h,d,m,g;u={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...u};const w=Na(t||n),F=w.background,R=w.environment,C={backgroundBlurriness:w.backgroundBlurriness,backgroundIntensity:w.backgroundIntensity,backgroundRotation:(h=(d=w.backgroundRotation)==null||d.clone==null?void 0:d.clone())!==null&&h!==void 0?h:[0,0,0],environmentIntensity:w.environmentIntensity,environmentRotation:(m=(g=w.environmentRotation)==null||g.clone==null?void 0:g.clone())!==null&&m!==void 0?m:[0,0,0]};return i!=="only"&&(w.environment=s),i&&(w.background=s),kr(w,u),()=>{i!=="only"&&(w.environment=R),i&&(w.background=F),kr(w,C)}}function Cr({scene:i,background:t=!1,map:n,...s}){const u=rr(h=>h.scene);return ae.useLayoutEffect(()=>{if(n)return br(t,i,u,n,s)}),null}function rt({background:i=!1,scene:t,blur:n,backgroundBlurriness:s,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:m,...g}){const w=hr(g),F=rr(R=>R.scene);return ae.useLayoutEffect(()=>br(i,t,F,w,{backgroundBlurriness:n??s,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:d,environmentRotation:m})),null}function Da({children:i,near:t=.1,far:n=1e3,resolution:s=256,frames:u=1,map:h,background:d=!1,blur:m,backgroundBlurriness:g,backgroundIntensity:w,backgroundRotation:F,environmentIntensity:R,environmentRotation:C,scene:L,files:G,path:he,preset:W=void 0,extensions:ie}){const oe=rr(S=>S.gl),de=rr(S=>S.scene),se=ae.useRef(null),[H]=ae.useState(()=>new Pr),D=ae.useMemo(()=>{const S=new jt(s);return S.texture.type=Se,S},[s]);ae.useLayoutEffect(()=>{if(u===1){const S=oe.autoClear;oe.autoClear=!0,se.current.update(oe,H),oe.autoClear=S}return br(d,L,de,D.texture,{backgroundBlurriness:m??g,backgroundIntensity:w,backgroundRotation:F,environmentIntensity:R,environmentRotation:C})},[i,H,D.texture,L,de,d,u,oe]);let j=1;return ea(()=>{if(u===1/0||j<u){const S=oe.autoClear;oe.autoClear=!0,se.current.update(oe,H),oe.autoClear=S,j++}}),ae.createElement(ae.Fragment,null,ra(ae.createElement(ae.Fragment,null,i,ae.createElement("cubeCamera",{ref:se,args:[t,n,D]}),G||W?ae.createElement(rt,{background:!0,files:G,preset:W,path:he,extensions:ie}):h?ae.createElement(Cr,{background:!0,map:h,extensions:ie}):null),H))}function Ba(i){var t,n,s,u;const h=hr(i),d=i.map||h;ae.useMemo(()=>Jt({GroundProjectedEnvImpl:fa}),[]);const m=ae.useMemo(()=>[d],[d]),g=(t=i.ground)==null?void 0:t.height,w=(n=i.ground)==null?void 0:n.radius,F=(s=(u=i.ground)==null?void 0:u.scale)!==null&&s!==void 0?s:1e3;return ae.createElement(ae.Fragment,null,ae.createElement(Cr,Qt({},i,{map:d})),ae.createElement("groundProjectedEnvImpl",{args:m,scale:F,height:g,radius:w}))}function La(i){return i.ground?ae.createElement(Ba,i):i.map?ae.createElement(Cr,i):i.children?ae.createElement(Da,i):ae.createElement(rt,i)}export{La as E};
