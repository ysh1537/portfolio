import{r as e,_ as v,P,a as M,g as h,f as R,V as U,b as I,c as z,j as d,D as F,A as C,M as j}from"./index-DIejhpZU.js";import{E as D}from"./Environment-D1caa6hu.js";import{B as T}from"./Billboard-BI7mxHw8.js";import{T as B}from"./Text-BUKx5TYS.js";import{v as _,H,F as L}from"./Float-DX9rMsZk.js";const E=_>=154?"opaque_fragment":"output_fragment";class W extends P{constructor(u){super(u),this.onBeforeCompile=(t,o)=>{const{isWebGL2:l}=o.capabilities;t.fragmentShader=t.fragmentShader.replace(`#include <${E}>`,`
        ${l?`#include <${E}>`:`#extension GL_OES_standard_derivatives : enable
#include <${E}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${_>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const N=e.forwardRef((m,u)=>{const[t]=e.useState(()=>new W(null));return e.createElement("primitive",v({},m,{object:t,ref:u,attach:"material"}))});let y,b;const $=e.createContext(null),w=new R,S=new U,q=e.forwardRef(({children:m,range:u,limit:t=1e3,...o},l)=>{const n=e.useRef(null);e.useImperativeHandle(l,()=>n.current,[]);const[i,r]=e.useState([]),[[s,c,a]]=e.useState(()=>[new Float32Array(t*3),Float32Array.from({length:t*3},()=>1),Float32Array.from({length:t},()=>1)]);e.useEffect(()=>{n.current.geometry.attributes.position.needsUpdate=!0}),M(()=>{for(n.current.updateMatrix(),n.current.updateMatrixWorld(),w.copy(n.current.matrixWorld).invert(),n.current.geometry.drawRange.count=Math.min(t,u!==void 0?u:t,i.length),y=0;y<i.length;y++)b=i[y].current,b.getWorldPosition(S).applyMatrix4(w),S.toArray(s,y*3),n.current.geometry.attributes.position.needsUpdate=!0,b.matrixWorldNeedsUpdate=!0,b.color.toArray(c,y*3),n.current.geometry.attributes.color.needsUpdate=!0,a.set([b.size],y),n.current.geometry.attributes.size.needsUpdate=!0});const f=e.useMemo(()=>({getParent:()=>n,subscribe:p=>(r(g=>[...g,p]),()=>r(g=>g.filter(x=>x.current!==p.current)))}),[]);return e.createElement("points",v({userData:{instances:i},matrixAutoUpdate:!1,ref:n,raycast:()=>null},o),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:h}),e.createElement("bufferAttribute",{attach:"attributes-color",count:c.length/3,array:c,itemSize:3,usage:h}),e.createElement("bufferAttribute",{attach:"attributes-size",count:a.length,array:a,itemSize:1,usage:h})),e.createElement($.Provider,{value:f},m))}),G=e.forwardRef(({children:m,positions:u,colors:t,sizes:o,stride:l=3,...n},i)=>{const r=e.useRef(null);return e.useImperativeHandle(i,()=>r.current,[]),M(()=>{const s=r.current.geometry.attributes;s.position.needsUpdate=!0,t&&(s.color.needsUpdate=!0),o&&(s.size.needsUpdate=!0)}),e.createElement("points",v({ref:r},n),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:u.length/l,array:u,itemSize:l,usage:h}),t&&e.createElement("bufferAttribute",{attach:"attributes-color",count:t.length/l,array:t,itemSize:3,usage:h}),o&&e.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/l,array:o,itemSize:1,usage:h})),m)}),O=e.forwardRef((m,u)=>m.positions instanceof Float32Array?e.createElement(G,v({},m,{ref:u})):e.createElement(q,v({},m,{ref:u}))),X=m=>{const[u,t]=e.useState(null),o=e.useRef(null),l=e.useRef(null);return e.useEffect(()=>{const n=()=>{l.current&&l.current.getTracks().forEach(i=>i.stop()),o.current&&o.current.close()};return m==="mic"?(n(),(async()=>{try{const r=await navigator.mediaDevices.getUserMedia({audio:!0});l.current=r;const s=new(window.AudioContext||window.webkitAudioContext);o.current=s;const c=s.createMediaStreamSource(r),a=s.createAnalyser();a.fftSize=256,c.connect(a),t(a)}catch(r){console.error("Mic Error:",r)}})()):(n(),t(null)),n},[m]),u},V=({analyser:m,mode:u})=>{const t=e.useRef(),o=500,[l]=e.useState(()=>{const i=new Float32Array(o*3);for(let r=0;r<o;r++)i[r*3]=(Math.random()-.5)*10,i[r*3+1]=(Math.random()-.5)*5,i[r*3+2]=(Math.random()-.5)*5;return i}),n=e.useMemo(()=>new Uint8Array(128),[]);return M(i=>{if(!t.current)return;let r=0;if(u==="mic"&&m)m.getByteFrequencyData(n),r=n.reduce((a,f)=>a+f,0)/n.length/255;else{const a=i.clock.elapsedTime;r=(Math.sin(a)*.5+.5)*.5}const s=t.current.geometry.attributes.position.array;for(let a=0;a<o;a++){let f=l[a*3],p=l[a*3+1],g=l[a*3+2];const x=1+r*2,A=i.clock.elapsedTime,k=Math.sin(A+f)*.2;s[a*3]=f*x+Math.sin(A*2+p)*.1,s[a*3+1]=p*x+Math.cos(A*1.5+f)*.1,s[a*3+2]=g*x+k}t.current.geometry.attributes.position.needsUpdate=!0;const c=t.current.material;c&&(c.size=.05+r*.2,c.color&&c.color.setHSL(.5+r*.5,1,.5))}),d.jsx(O,{ref:t,positions:l,stride:3,children:d.jsx(N,{transparent:!0,color:"#06b6d4",size:.05,sizeAttenuation:!0,depthWrite:!1,blending:C})})},Y=({analyser:m,mode:u})=>{const t=e.useRef(),o=16,l=.6,n=e.useMemo(()=>new Uint8Array(32),[]);return M(i=>{if(!t.current)return;let r=[];if(u==="mic"&&m)m.getByteFrequencyData(n),r=Array.from(n).slice(0,o);else{const s=i.clock.elapsedTime;for(let c=0;c<o;c++){const a=(Math.sin(s*3+c*.5)+Math.cos(s*2+c*.2))*.5+.5;r.push(a*255)}}t.current.children.forEach((s,c)=>{if(r[c]!==void 0&&s.material){const a=r[c]/255,f=.5+a*5;s.scale.y=j.lerp(s.scale.y,f,.2);const p=.5+a*.3;s.material.color&&s.material.color.setHSL(p,1,.5),s.material.emissive&&s.material.emissive.setHSL(p,1,.2),"emissiveIntensity"in s.material&&(s.material.emissiveIntensity=a*3)}})}),d.jsx("group",{ref:t,position:[-9.6/2,-2,0],children:Array.from({length:o}).map((i,r)=>d.jsxs("mesh",{position:[r*l,2,0],children:[d.jsx("boxGeometry",{args:[.4,1,.4]}),d.jsx("meshStandardMaterial",{color:"#06b6d4",roughness:.2,metalness:.8})]},r))})},Z=({analyser:m,mode:u})=>{const t=e.useRef(),o=e.useMemo(()=>new Uint8Array(64),[]);return M(l=>{if(!t.current)return;let n=0;u==="mic"&&m?(m.getByteFrequencyData(o),n=o.reduce((c,a)=>c+a,0)/o.length/255):n=(Math.sin(l.clock.elapsedTime)*.5+.5)*.6;const i=t.current.geometry.attributes.position,r=l.clock.elapsedTime;for(let c=0;c<i.count;c++){const a=i.getX(c),f=i.getY(c),p=Math.sqrt(a*a+f*f);let g=Math.sin(p*1.5-r*2)*(.2+n*1.5);g+=Math.cos(a*2+r)*.1,i.setZ(c,g)}i.needsUpdate=!0;const s=t.current.material;if(s&&"emissiveIntensity"in s){const c=n*3;s.emissiveIntensity=j.lerp(s.emissiveIntensity,c,.1)}}),d.jsxs("mesh",{ref:t,position:[0,-3,-2],rotation:[-Math.PI/2.5,0,0],children:[d.jsx("planeGeometry",{args:[20,15,32,32]}),d.jsx("meshPhysicalMaterial",{color:"#ec4899",emissive:"#ec4899",emissiveIntensity:.5,wireframe:!0,transparent:!0,opacity:.3,side:F})]})},re=()=>{const m=I(i=>i.setScene),[u,t]=e.useState("demo"),o=X(u),{playClick:l,playHover:n}=z();return d.jsxs("group",{children:[d.jsx("color",{attach:"background",args:["#02040b"]}),d.jsx(D,{preset:"night"}),d.jsx(T,{children:d.jsx(B,{position:[0,6,-5],fontSize:.6,color:"white",anchorX:"center",children:"AUDIO LAB [SYNTHETIC]"})}),d.jsx(H,{position:[0,3.5,0],center:!0,transform:!0,distanceFactor:5,style:{pointerEvents:"auto"},children:d.jsxs("div",{className:"flex gap-4 p-2 bg-black/80 rounded border border-cyan-500/30 backdrop-blur-md",style:{pointerEvents:"auto"},children:[d.jsx("button",{onClick:()=>{l(),t("demo")},onPointerEnter:n,className:`px-4 py-1 rounded font-mono text-xs transition-all cursor-pointer ${u==="demo"?"bg-cyan-600 text-white shadow-[0_0_10px_cyan]":"text-cyan-500 hover:bg-cyan-900/50"}`,children:"DEMO_MODE"}),d.jsx("button",{onClick:()=>{l(),t("mic")},onPointerEnter:n,className:`px-4 py-1 rounded font-mono text-xs transition-all cursor-pointer ${u==="mic"?"bg-pink-600 text-white shadow-[0_0_10px_pink]":"text-pink-500 hover:bg-pink-900/50"}`,children:"LIVE_INPUT"}),d.jsx("button",{onClick:()=>{l(),m("hub")},onPointerEnter:n,className:"px-4 py-1 rounded font-mono text-xs border border-white/30 text-white/70 hover:bg-white/10 hover:border-white/50 hover:text-white transition-all shadow-lg cursor-pointer",children:"[ EXIT LAB ]"})]})}),d.jsx(L,{speed:2,rotationIntensity:.2,floatIntensity:.5,children:d.jsx(Y,{analyser:o,mode:u})}),d.jsx(Z,{analyser:o,mode:u}),d.jsx(V,{analyser:o,mode:u}),d.jsx("gridHelper",{args:[50,50,3355443,328965],position:[0,-4,0]})]})};export{re as default};
