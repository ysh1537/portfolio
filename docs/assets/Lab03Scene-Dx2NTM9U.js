import{j as o,ab as A,a7 as v,a9 as S,a5 as b,r as d,x as h,n as w,aj as R,ak as I,a2 as k,J as M}from"./three-C3NlESEC.js";import{u as T,b as E}from"./index-CeJVAl9A.js";import"./vendor-CqO7gtIP.js";import"./animation-r5s8DLQG.js";const P=l=>{const[u,r]=d.useState(null),a=d.useRef(null),m=d.useRef(null);return d.useEffect(()=>{let c=!0;const i=()=>{m.current&&m.current.getTracks().forEach(e=>e.stop()),a.current&&a.current.close()};return l==="mic"?(i(),(async()=>{try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});m.current=t;const s=new(window.AudioContext||window.webkitAudioContext);a.current=s;const n=s.createMediaStreamSource(t),f=s.createAnalyser();f.fftSize=256,n.connect(f),c&&r(f)}catch(t){console.error("Mic Error:",t)}})()):(i(),setTimeout(()=>{c&&r(null)},0)),()=>{c=!1,i()}},[l]),u},z=({analyser:l,mode:u})=>{const r=d.useRef(),a=500,[m]=d.useState(()=>{const i=new Float32Array(a*3);for(let e=0;e<a;e++)i[e*3]=(Math.random()-.5)*10,i[e*3+1]=(Math.random()-.5)*5,i[e*3+2]=(Math.random()-.5)*5;return i}),c=d.useMemo(()=>new Uint8Array(128),[]);return h(i=>{if(!r.current)return;let e=0;if(u==="mic"&&l)l.getByteFrequencyData(c),e=c.reduce((n,f)=>n+f,0)/c.length/255;else{const n=i.clock.elapsedTime;e=(Math.sin(n)*.5+.5)*.5}const t=r.current.geometry.attributes.position.array;for(let n=0;n<a;n++){let f=m[n*3],y=m[n*3+1],p=m[n*3+2];const g=1+e*2,x=i.clock.elapsedTime,j=Math.sin(x+f)*.2;t[n*3]=f*g+Math.sin(x*2+y)*.1,t[n*3+1]=y*g+Math.cos(x*1.5+f)*.1,t[n*3+2]=p*g+j}r.current.geometry.attributes.position.needsUpdate=!0;const s=r.current.material;s&&(s.size=.05+e*.2,s.color&&s.color.setHSL(.5+e*.5,1,.5))}),o.jsx(R,{ref:r,positions:m,stride:3,children:o.jsx(I,{transparent:!0,color:"#facc15",size:.05,sizeAttenuation:!0,depthWrite:!1,blending:k})})},C=({analyser:l,mode:u})=>{const r=d.useRef(),a=16,m=.6,c=d.useMemo(()=>new Uint8Array(32),[]);return h(i=>{if(!r.current)return;let e=[];if(u==="mic"&&l)l.getByteFrequencyData(c),e=Array.from(c).slice(0,a);else{const t=i.clock.elapsedTime;for(let s=0;s<a;s++){const n=(Math.sin(t*3+s*.5)+Math.cos(t*2+s*.2))*.5+.5;e.push(n*255)}}r.current.children.forEach((t,s)=>{if(e[s]!==void 0&&t.material){const n=e[s]/255,f=.5+n*5;t.scale.y=M.lerp(t.scale.y,f,.2);const y=.5+n*.3;t.material.color&&t.material.color.setHSL(y,1,.5),t.material.emissive&&t.material.emissive.setHSL(y,1,.2),"emissiveIntensity"in t.material&&(t.material.emissiveIntensity=n*3)}})}),o.jsx("group",{ref:r,position:[-9.6/2,-2,0],children:Array.from({length:a}).map((i,e)=>o.jsxs("mesh",{position:[e*m,2,0],children:[o.jsx("boxGeometry",{args:[.4,1,.4]}),o.jsx("meshStandardMaterial",{color:"#06b6d4",roughness:.2,metalness:.8})]},e))})},F=({analyser:l,mode:u})=>{const r=d.useRef(),a=d.useMemo(()=>new Uint8Array(64),[]);return h(m=>{if(!r.current)return;let c=0;u==="mic"&&l?(l.getByteFrequencyData(a),c=a.reduce((s,n)=>s+n,0)/a.length/255):c=(Math.sin(m.clock.elapsedTime)*.5+.5)*.6;const i=r.current.geometry.attributes.position,e=m.clock.elapsedTime;for(let s=0;s<i.count;s++){const n=i.getX(s),f=i.getY(s),y=Math.sqrt(n*n+f*f);let p=Math.sin(y*1.5-e*2)*(.2+c*1.5);p+=Math.cos(n*2+e)*.1,i.setZ(s,p)}i.needsUpdate=!0;const t=r.current.material;if(t&&"emissiveIntensity"in t){const s=c*3;t.emissiveIntensity=M.lerp(t.emissiveIntensity,s,.1)}}),o.jsxs("mesh",{ref:r,position:[0,-3,-2],rotation:[-Math.PI/2.5,0,0],children:[o.jsx("planeGeometry",{args:[20,15,32,32]}),o.jsx("meshPhysicalMaterial",{color:"#ec4899",emissive:"#ec4899",emissiveIntensity:.5,wireframe:!0,transparent:!0,opacity:.3,side:w})]})},U=({analyser:l,mode:u})=>{const r=d.useRef(),a=d.useMemo(()=>new Uint8Array(32),[]);return h(m=>{if(!r.current)return;let c=0;u==="mic"&&l?(l.getByteFrequencyData(a),c=a.slice(0,10).reduce((t,s)=>t+s,0)/10/255):c=(Math.sin(m.clock.elapsedTime*4)*.5+.5)*.8;const i=1+c*.5;r.current.scale.set(i,i,i);const e=r.current.material;e&&(e.emissiveIntensity=.5+c*2)}),o.jsxs("mesh",{ref:r,position:[0,0,0],children:[o.jsx("sphereGeometry",{args:[1.5,64,64]}),o.jsx("meshPhysicalMaterial",{color:"#7c3aed",emissive:"#4c1d95",roughness:.2,metalness:.8,clearcoat:1,clearcoatRoughness:.1})]})},G=()=>{const u=T(a=>a.lab03Config).mode,r=P(u);return E(),o.jsxs("group",{children:[o.jsx("color",{attach:"background",args:["#020617"]}),o.jsx("fogExp2",{attach:"fog",args:["#020617",.04]}),o.jsx(A,{preset:"city"}),o.jsx(v,{children:o.jsx(S,{position:[0,6,-5],fontSize:.6,color:"#d8b4fe",anchorX:"center",children:"SONIC GIANT [HARMONICS]"})}),o.jsxs(b,{speed:2,rotationIntensity:.2,floatIntensity:.5,children:[o.jsx(U,{analyser:r,mode:u}),o.jsx(C,{analyser:r,mode:u})]}),o.jsx(F,{analyser:r,mode:u}),o.jsx(z,{analyser:r,mode:u}),o.jsx("gridHelper",{args:[50,50,8141549,1973067],position:[0,-4,0]})]})};export{G as default};
